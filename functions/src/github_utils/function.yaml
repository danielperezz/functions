metadata:
  tag: ''
  categories:
  - utils
  name: github-utils
spec:
  description: add comments to github pull request
  default_handler: run_summary_comment
  build:
    functionSourceCode: IyBDb3B5cmlnaHQgMjAxOSBJZ3VhemlvCiMKIyBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgIkxpY2Vuc2UiKTsKIyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuCiMgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0CiMKIyAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wCiMKIyBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlCiMgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gIkFTIElTIiBCQVNJUywKIyBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4KIyBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kCiMgbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuCiMKIyBHZW5lcmF0ZWQgYnkgbnVjbGlvLmV4cG9ydC5OdWNsaW9FeHBvcnRlcgoKaW1wb3J0IHJlcXVlc3RzCmltcG9ydCBvcwpmcm9tIG1scnVuIGltcG9ydCBEYXRhSXRlbSwgZ2V0X3J1bl9kYiwgbWxjb25mCgoKZGVmIHByX2NvbW1lbnQoCiAgICBjb250ZXh0LCByZXBvOiBzdHIsIGlzc3VlOiBpbnQsIG1lc3NhZ2U6IHN0ciA9ICIiLCBtZXNzYWdlX2ZpbGU6IERhdGFJdGVtID0gTm9uZQopOgoKICAgIHRva2VuID0gY29udGV4dC5nZXRfc2VjcmV0KCJHSVRIVUJfVE9LRU4iKSBvciBvcy5lbnZpcm9uLmdldCgiR0lUSFVCX1RPS0VOIikKICAgIGlmIG1lc3NhZ2VfZmlsZSBhbmQgbm90IG1lc3NhZ2U6CiAgICAgICAgbWVzc2FnZSA9IG1lc3NhZ2VfZmlsZS5nZXQoKQogICAgZWxpZiBub3QgbWVzc2FnZSBhbmQgbm90IG1lc3NhZ2VfZmlsZToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCJwciBtZXNzYWdlIG9yIG1lc3NhZ2UgZmlsZSBtdXN0IGJlIHByb3ZpZGVkIikKCiAgICBoZWFkZXJzID0gewogICAgICAgICJBY2NlcHQiOiAiYXBwbGljYXRpb24vdm5kLmdpdGh1Yi52Mytqc29uIiwKICAgICAgICAiQXV0aG9yaXphdGlvbiI6IGYidG9rZW4ge3Rva2VufSIsCiAgICB9CiAgICB1cmwgPSBmImh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vcmVwb3Mve3JlcG99L2lzc3Vlcy97aXNzdWV9L2NvbW1lbnRzIgoKICAgIHJlc3AgPSByZXF1ZXN0cy5wb3N0KHVybD11cmwsIGpzb249eyJib2R5Ijogc3RyKG1lc3NhZ2UpfSwgaGVhZGVycz1oZWFkZXJzKQogICAgaWYgbm90IHJlc3Aub2s6CiAgICAgICAgZXJybXNnID0gZiJiYWQgcHIgY29tbWVudCByZXNwISFcbntyZXNwLnRleHR9IgogICAgICAgIGNvbnRleHQubG9nZ2VyLmVycm9yKGVycm1zZykKICAgICAgICByYWlzZSBJT0Vycm9yKGVycm1zZykKCgpkZWYgcnVuX3N1bW1hcnlfY29tbWVudChjb250ZXh0LCB3b3JrZmxvd19pZCwgcmVwbzogc3RyLCBpc3N1ZTogaW50LCBwcm9qZWN0PSIiKToKICAgIGRiID0gZ2V0X3J1bl9kYigpLmNvbm5lY3QoKQogICAgcHJvamVjdCA9IHByb2plY3Qgb3IgY29udGV4dC5wcm9qZWN0CiAgICBydW5zID0gZGIubGlzdF9ydW5zKHByb2plY3Q9cHJvamVjdCwgbGFiZWxzPWYid29ya2Zsb3c9e3dvcmtmbG93X2lkfSIpCgogICAgaGFkX2Vycm9ycyA9IGkgPSAwCiAgICBmb3IgciBpbiBydW5zOgogICAgICAgIG5hbWUgPSByWyJtZXRhZGF0YSJdWyJuYW1lIl0KICAgICAgICBpZiByWyJzdGF0dXMiXS5nZXQoInN0YXRlIiwgIiIpID09ICJlcnJvciI6CiAgICAgICAgICAgIGhhZF9lcnJvcnMgKz0gMQogICAgICAgIGlmIG5hbWUgPT0gY29udGV4dC5uYW1lOgogICAgICAgICAgICBkZWwgcnVuc1tpXQogICAgICAgIGkgKz0gMQoKICAgIHByaW50KCJlcnJvcnM6IiwgaGFkX2Vycm9ycykKCiAgICBodG1sID0gIiMjIyBSdW4gUmVzdWx0c1xuV29ya2Zsb3cge30gZmluaXNoZWQgd2l0aCB7fSBlcnJvcnMiLmZvcm1hdCgKICAgICAgICB3b3JrZmxvd19pZCwgaGFkX2Vycm9ycwogICAgKQogICAgaHRtbCArPSAiPGJyPmNsaWNrIHRoZSBoeXBlciBsaW5rcyBiZWxvdyB0byBzZWUgZGV0YWlsZWQgcmVzdWx0czxicj4iCiAgICBodG1sICs9IHJ1bnMuc2hvdyhkaXNwbGF5PUZhbHNlLCBzaG9ydD1UcnVlKQogICAgaWYgcmVwbzoKICAgICAgICBwcl9jb21tZW50KGNvbnRleHQsIHJlcG8sIGlzc3VlLCBodG1sKQogICAgZWxzZToKICAgICAgICBwcmludCgicmVwbyBub3QgZGVmaW5lZCIpCiAgICAgICAgcHJpbnQoaHRtbCkK
    origin_filename: ''
    code_origin: ''
  entry_points:
    pr_comment:
      parameters:
      - name: context
      - name: repo
        type: str
      - name: issue
        type: int
      - name: message
        type: str
        default: ''
      - name: message_file
        type: DataItem
        default: null
      doc: ''
      name: pr_comment
      lineno: 22
      has_kwargs: false
      has_varargs: false
    run_summary_comment:
      parameters:
      - name: context
      - name: workflow_id
      - name: repo
        type: str
      - name: issue
        type: int
      - name: project
        default: ''
      doc: ''
      name: run_summary_comment
      lineno: 45
      has_kwargs: false
      has_varargs: false
  command: ''
  image: mlrun/mlrun
  disable_auto_mount: false
kind: job
verbose: false
